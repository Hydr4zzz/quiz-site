<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>QuizMania</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      background-color: #ffeb3b;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    #app {
      padding: 20px;
    }
    .menu, .quiz, .question-form, .user-form {
      display: none;
    }
    .visible {
      display: block;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 18px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 18px;
    }
    .question {
      margin-top: 20px;
    }
    .option {
      display: block;
      margin: 5px auto;
      padding: 10px;
      background-color: #2196f3;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      width: 200px;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="user-form" class="user-form visible">
      <h1>Bem-vindo ao QuizMania!</h1>
      <p>Digite seu nome de usuário:</p>
      <input type="text" id="username" />
      <button onclick="setUsername()">Entrar</button>
    </div>

    <div id="menu" class="menu">
      <h2>Olá, <span id="displayName"></span>!</h2>
      <button onclick="showAllQuizzes()">Quizes</button>
      <button onclick="showUserQuizzes()">Seus Quizes</button>
      <button onclick="startCreateQuiz()">Criar Quizes</button>
      <button onclick="changeUser()">Trocar Usuário</button>
    </div>

    <div id="quiz-list" class="quiz"></div>
    <div id="user-quiz-list" class="quiz"></div>
    <div id="question-form" class="question-form"></div>
    <div id="quiz-play" class="quiz"></div>
  </div>

  <audio id="click-sound" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>
  <audio id="bg-music" src="https://www.bensound.com/bensound-music/bensound-buddy.mp3" autoplay loop></audio>

  <script>
    let currentUser = null;
    let quizzes = JSON.parse(localStorage.getItem("quizzes") || "[]");
    let creatingQuiz = [];
    let currentQuiz = null;
    let currentQuestionIndex = 0;

    function playClick() {
      document.getElementById('click-sound').play();
    }

    function setUsername() {
      playClick();
      const name = document.getElementById("username").value.trim();
      if (name) {
        currentUser = name;
        document.getElementById("user-form").classList.remove("visible");
        document.getElementById("menu").classList.add("visible");
        document.getElementById("displayName").textContent = name;
      }
    }

    function changeUser() {
      playClick();
      currentUser = null;
      creatingQuiz = [];
      document.getElementById("menu").classList.remove("visible");
      document.getElementById("user-form").classList.add("visible");
    }

    function showAllQuizzes() {
      playClick();
      showQuizzes(quizzes, "quiz-list");
    }

    function showUserQuizzes() {
      playClick();
      const userQuizzes = quizzes.filter(q => q.user === currentUser);
      showQuizzes(userQuizzes, "user-quiz-list");
    }

    function showQuizzes(list, containerId) {
      document.querySelectorAll(".quiz").forEach(div => div.classList.remove("visible"));
      const container = document.getElementById(containerId);
      container.innerHTML = '<h3>Escolha um quiz:</h3>';
      list.forEach((quiz, index) => {
        const btn = document.createElement("button");
        btn.textContent = quiz.title || `Quiz ${index + 1}`;
        btn.onclick = () => startQuiz(quiz);
        container.appendChild(btn);
      });
      container.classList.add("visible");
    }

    function startCreateQuiz() {
      playClick();
      creatingQuiz = [];
      showQuestionForm();
    }

    function showQuestionForm() {
      document.querySelectorAll(".quiz, .menu").forEach(div => div.classList.remove("visible"));
      const form = document.getElementById("question-form");
      form.innerHTML = '<h3>Crie uma pergunta</h3>';
      form.innerHTML += '<input type="text" id="qtext" placeholder="Pergunta" /><br>';
      for (let i = 0; i < 4; i++) {
        form.innerHTML += `<input type="text" class="opt" placeholder="Opção ${i + 1}" /><br>`;
      }
      form.innerHTML += '<p>Escolha a resposta correta (0-3):</p><input type="number" id="correct" min="0" max="3" /><br>';
      form.innerHTML += '<button onclick="addQuestion()">Adicionar Pergunta</button>';
      if (creatingQuiz.length >= 10) {
        form.innerHTML += '<br><button onclick="finalizeQuiz()">Finalizar Quiz</button>';
      }
      form.classList.add("visible");
    }

    function addQuestion() {
      playClick();
      const text = document.getElementById("qtext").value;
      const options = [...document.querySelectorAll(".opt")].map(opt => opt.value);
      const correct = parseInt(document.getElementById("correct").value);
      if (text && options.every(o => o) && correct >= 0 && correct <= 3) {
        creatingQuiz.push({ text, options, correct });
        if (creatingQuiz.length >= 10) finalizeQuiz();
        else showQuestionForm();
      }
    }

    function finalizeQuiz() {
      playClick();
      const title = prompt("Nome do quiz:");
      quizzes.push({ user: currentUser, questions: creatingQuiz, title });
      localStorage.setItem("quizzes", JSON.stringify(quizzes));
      creatingQuiz = [];
      document.getElementById("question-form").classList.remove("visible");
      document.getElementById("menu").classList.add("visible");
    }

    function startQuiz(quiz) {
      playClick();
      currentQuiz = quiz;
      currentQuestionIndex = 0;
      document.querySelectorAll(".quiz").forEach(div => div.classList.remove("visible"));
      document.getElementById("quiz-play").classList.add("visible");
      showQuestion();
    }

    function showQuestion() {
      const container = document.getElementById("quiz-play");
      const question = currentQuiz.questions[currentQuestionIndex];
      container.innerHTML = `<h3>${question.text}</h3>`;
      question.options.forEach((opt, i) => {
        const btn = document.createElement("div");
        btn.textContent = opt;
        btn.className = "option";
        btn.onclick = () => answerQuestion(i);
        container.appendChild(btn);
      });
    }

    function answerQuestion(index) {
      playClick();
      const correct = currentQuiz.questions[currentQuestionIndex].correct;
      if (index === correct) {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuiz.questions.length) {
          showQuestion();
        } else {
          alert("Você venceu!");
          document.getElementById("quiz-play").classList.remove("visible");
          document.getElementById("menu").classList.add("visible");
        }
      } else {
        alert("Errou! Tente novamente depois.");
        document.getElementById("quiz-play").classList.remove("visible");
        document.getElementById("menu").classList.add("visible");
      }
    }
  </script>
</body>
</html>
